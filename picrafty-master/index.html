<!DOCTYPE html>
<!-- Author: Justin Erickson -->
<html>
<head>
  <meta charset="utf-8">
  <title>HSV_STEAMWORKS: BLOCKLY MC DEMO</title>
  <!-- TODO: this needs to be set up for relative filepaths so that it can be used on any computer --> 
  <!-- To get this to run on your machine youll need to make these filepaths point to the following scripts on you machine-->
  <script src="js_scripts/blockly_compressed.js"></script>
  <script src="js_scripts/python_compressed.js"></script>
  <script src="js_scripts/test_block.js"></script>
  <script src="js_scripts/get_block.js"></script>
  <script src="msg/js/en.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <p>
    <button onclick="showCode()">Show Python Stub</button>
  </p>
  <!-- This is the Div Blockly will render in. size can be adjusted here -->
  <!-- TODO: Have this Dynamicially set based off browser resolutionn(resziable Demo For example) -->
  <div id="blocklyDiv" style="height: 600px; width: 800px;"></div>
  
  <!--This defines the toolbox to be given to Blockly.  --> 
  <!--Additional blocks can be added and catogrized.   --> 
  <xml id="toolbox" style="display: none">
    <category name="test" colour="%{BKY_LOGIC_HUE}">
        <block type="hello_world"></block>
     </category>
    <category name="get_block" colour="%{BKY_LOGIC_HUE}">
      <block type="get_block"></block>
    </category>
  </xml>
  
  <!-- TODO: this needs to be set up for relative filepaths so that it can be used on any computer --> 
  <!--Speceficially the path for media --> 
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: '\\media' + "\\",
         toolbox: document.getElementById('toolbox')});
  </script>
  <script>
	function showCode() {
	// Generate python  code and display it/Save It.
	//This helps Blockly avoid getting hung up
	Blockly.Python.INFINITE_LOOP_TRAP = null;
	//This converts the workspace into Code using the Code generation snippet in test_block
	var code = Blockly.Python.workspaceToCode(demoWorkspace);
	//This is all Preperation For Downloading the file
	var PythonStub = new Blob([code], {type:"text/plain"});
	var textToSaveAsURL = window.URL.createObjectURL(PythonStub);
	var downloadLink = document.createElement("a");
		downloadLink.download = 'Pythong_stub.py';
		downloadLink.innerHTML = "Download File";
		downloadLink.href = textToSaveAsURL;
		downloadLink.onclick = destroyClickedElement;
		downloadLink.style.display = "none";
		document.body.appendChild(downloadLink);
	//Clicks on the created element to Prompt for download. 
		downloadLink.click();
		
		//Helpful for Debugging
		//alert(code);
	}
	function destroyClickedElement(event)
	{
		document.body.removeChild(event.target);
	}
  </script>
</body>
</html>
